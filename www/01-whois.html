<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Hippo</title>
<meta name="format-detection" content="telephone=no" />
<meta name="msapplication-tap-highlight" content="no" />
<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />

<link rel="stylesheet" type="text/css" href="css/common.css" />
<style type="text/css">
h1, h2, h3 {
	margin: 0.5em;
	font-weight: bold;
	text-align: center;
	color: #4473CA;
}
h1 {
	font-size: 180%;
}
h2 {
	font-size: 160%;
}
h3 {
	font-size: 140%;
}
pre {
	white-space: pre-wrap;
}
#box {
	margin: 1em;
}
#wrapper {
	padding: 1em;
}
#formSend {
	display: none;
	margin: 1em 0;
	text-align: center;
}
#formSend input {
	padding: 0.5em;
	font-size: 100%;
}
#formSend input[type="text"] {
	min-width: 10em;
	width: 30%;
}
#formSend input[type="submit"] {
	min-width: 8em;
	width: 10%;
}
</style>

<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript">
///////////////////////////////////////////////////////////////////////////////
// WhoIs
///////////////////////////////////////////////////////////////////////////////
// cordova plugin add cordova-plugin-device
///////////////////////////////////////////////////////////////////////////////

document.addEventListener('deviceready', onDeviceReady, false);

function onDeviceReady() {
	document.getElementById('welcome').style.display = 'none';
	document.getElementById('box').style.display = 'block';
	
	
}

var app = {
	initialize: function () {
		this.bindEvents();
	},
	// load, deviceready, offline, online
	bindEvents: function () {
		document.addEventListener('deviceready', this.onDeviceReady, false);
	},
	onDeviceReady: function () {
		var URL = 'http://whoisxmlapi.com/whoisserver/WhoisService?domainName=';
		var result = document.getElementById('result');
		var formSend = document.getElementById('formSend');
		var txtDomain = document.getElementById('txtDomain');
		document.getElementById('box').style.display = 'none';
		formSend.style.display = 'block';
		//
		function parseRaws(raws) {
			for (var i in raws) {
				var raw = raws[i].firstChild.nodeValue;
				if (raw.indexOf('Domain Name:') === 0) {
					return raw;
				}
			}
			// else last
			return raws[raws.length - 1].firstChild.nodeValue;
		}
		//
		function onFormSubmit(e) {
			e.preventDefault();
			var req = new XMLHttpRequest();
			req.onreadystatechange = function () {
				if (req.readyState != 4 || req.status != 200) return;
				var dom = req.responseXML;
				var raws = dom.getElementsByTagName('rawText');
				var raw = raws[raws.length - 1].firstChild.nodeValue;
				//var raw = parseRaws(raws);
				//var serializer = new XMLSerializer();
				//var raw = serializer.serializeToString(dom);
				result.innerHTML = '<pre>' + raw + '</pre>';
			};
			req.open('GET', URL + txtDomain.value, true);
			req.send(null);
			result.innerHTML = 'Processing...'
		}
		formSend.addEventListener('submit', onFormSubmit, false);
	}
};

app.initialize();
</script>
</head>

<body>
<div id="wrapper">
	<div id="welcome">
		<h1>Welcome to HippoApp</h1>
		<h3>Please wait...</h3>
	</div>
	<div id="box">
		<form action="" id="formSend">
			<input type="text" id="txtDomain" value="ya.ru" />
			<input type="submit" value="check domain" />
		</form>
		<div id="result"></div>
	</div>
</div>
</body>
</html>