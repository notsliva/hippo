<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Hippo</title>
<meta name="format-detection" content="telephone=no" />
<meta name="msapplication-tap-highlight" content="no" />
<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />

<link rel="stylesheet" type="text/css" href="css/common.css" />
<style type="text/css">
#dialpad {
	width: 200px;
	text-align: center;
	background: #cdf;
}
#dialpad input {
	width: 80%;
}
#dialpad input[type="button"] {
	padding: 1em;
}
#pad {
	height: 240px;
	margin: 1em 0 1em 0.8em;
}
#pad .btn {
	float: left;
	margin: 0 0.5em 0.5em 0;
	width: 55px;
	height: 55px;
	line-height: 55px;
	border-radius: 10px;
	background: #abc;
}
#pad .btn:active, #dialpad input[type="button"] {
	background: #ccc;
}
</style>

<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="js/trim.js"></script>
<script type="text/javascript">
///////////////////////////////////////////////////////////////////////////////
// DialPad
///////////////////////////////////////////////////////////////////////////////
// cordova plugin add cordova-plugin-device
// cordova plugin add cordova-plugin-media
// cordova plugin add cordova-plugin-contacts
///////////////////////////////////////////////////////////////////////////////

var URL_MP3, tm,
	txtPhone, pad, btnPlus, btnAdd;
document.addEventListener('deviceready', onDeviceReady, false);

function onDeviceReady() {
	document.getElementById('welcome').style.display = 'none';
	document.getElementById('container').style.display = 'block';
	document.getElementById('btnExit').ontouchend = function () {
		navigator.app.exitApp();
	};
	//
	URL_MP3 = getMediaURL('res/btn.mp3');
	txtPhone = document.getElementById('txtPhone');
	pad = document.getElementById('pad');
	btnPlus = document.getElementById('btnPlus');
	btnAdd = document.getElementById('btnAdd');
	//
	pad.addEventListener('touchstart', onPadClick, false);
	btnPlus.addEventListener('touchend', onPlusUp, false);
	btnAdd.addEventListener('touchend', onAddClick, false);
}

function onPadClick(e) {
	var self = e.target;
	if (self.className.indexOf('btn') == -1) return;
	//
	if (self.className.indexOf('clear') > -1) {
		txtPhone.value = '';
	}
	else if (self.className.indexOf('del') > -1) {
		var str = txtPhone.value;
		txtPhone.value = str.substring(0, str.length - 1);
	}
	else if (self.id == 'btnPlus') {
		tm = setTimeout(function () {
			clearTimeout(tm);
			tm = null;
			txtPhone.value += '+';
		}, 1000);
	}
	else {
		var num = parseInt(self.innerHTML);
		txtPhone.value += num;
	}
	//
	playAudio(URL_MP3);
}

function onPlusUp() {
	if (tm) {
		clearTimeout(tm);
		tm = null;
		txtPhone.value += '0';
	}
}

function onAddClick() {
	if (txtPhone.value == '') return;
	var dspName = prompt('Enter some name', '');
	if ( !dspName || !trim(dspName, ' ') ) return;
	//
	addContact(dspName, txtPhone.value);
}

function addContact(name, phone) {
	try {
		var contact = navigator.contacts.create();
		contact.displayName = name;
		contact.phoneNumbers = [new ContactField('mobile', phone, true)];
		//
		contact.save(
			function () {
				alert('Ok, contact is saved');
			},
			function (err) {
				alert(err);
			}
		);
	}
	catch (err) {
		console.log(err);
	}
}

function getMediaURL(url) {
	try {
		if (device.platform.toLowerCase() == 'android') {
			return '/android_asset/www/' + url;
		}
	}
	catch (err) {
		console.log(err);
	}
	return url;
}

function playAudio(url) {
	try {
		var myMedia = new Media(
			url,
			function () {
				myMedia.release();
			},
			function (err) {
				console.log(err);
			}
		);
		myMedia.play();
	}
	catch (err) {
		console.log(err);
	}
}
</script>
</head>

<body>
<div id="wrapper">
	<div id="welcome">
		<h2>Welcome to HippoApp</h2>
		<p>Application initialization...</p>
	</div>
	<div id="container">
		<div id="dialpad">
			<input type="tel" id="txtPhone" />
			<div id="pad">
				<div class="btn">1</div>
				<div class="btn">2</div>
				<div class="btn">3</div>
				<div class="btn">4</div>
				<div class="btn">5</div>
				<div class="btn">6</div>
				<div class="btn">7</div>
				<div class="btn">8</div>
				<div class="btn">9</div>
				<div class="btn clear">clear</div>
				<div class="btn" id="btnPlus">0/+</div>
				<div class="btn del">del</div>
			</div>
			<input type="button" id="btnAdd" value="add to phone book" />
		</div>
	</div>
</div>
<div id="header">
	<h1>DialPad</h1>
</div>
<div id="footer">
	<input type="button" id="btnExit" value="Exit"/>
</div>
</body>
</html>